# Acceptance testing

## 1. 인증 및 권한 관리 테스트

### 1.1 슈퍼 관리자 계정 생성 테스트
- **목적**: 시스템 초기화 시 기본 슈퍼 관리자 계정이 자동 생성되는지 확인
- **테스트 케이스**:
  - 시스템 첫 실행 시 `mama/mama` 계정이 자동 생성되는지 확인
  - 이미 존재하는 슈퍼 관리자 계정이 중복 생성되지 않는지 확인
  - 슈퍼 관리자 계정으로 로그인이 정상적으로 되는지 확인

### 1.2 로그인 기능 테스트
- **목적**: 관리자 로그인 기능이 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 올바른 사용자명/비밀번호로 로그인 시 JWT 토큰이 발급되는지 확인
  - 잘못된 사용자명/비밀번호로 로그인 시 401 에러가 반환되는지 확인
  - 존재하지 않는 계정으로 로그인 시 적절한 에러 메시지가 표시되는지 확인
  - 로그인 성공 시 이벤트 로그가 기록되는지 확인

### 1.3 패스워드 변경 테스트
- **목적**: 관리자가 자신의 패스워드를 변경할 수 있는지 확인
- **테스트 케이스**:
  - 현재 패스워드가 올바른 경우 패스워드 변경이 성공하는지 확인
  - 현재 패스워드가 틀린 경우 에러가 반환되는지 확인
  - 패스워드 변경 후 새로운 패스워드로 로그인이 가능한지 확인
  - 패스워드 변경 이벤트가 로그에 기록되는지 확인

### 1.4 관리자 계정 관리 테스트 (슈퍼 관리자 전용)
- **목적**: 슈퍼 관리자가 일반 관리자 계정을 생성/삭제할 수 있는지 확인
- **테스트 케이스**:
  - 슈퍼 관리자가 새로운 관리자 계정을 생성할 수 있는지 확인
  - 일반 관리자가 관리자 계정 생성 시도 시 권한 에러가 발생하는지 확인
  - 생성된 관리자 계정으로 로그인이 가능한지 확인
  - 관리자 계정 생성/삭제 이벤트가 로그에 기록되는지 확인

## 2. 사용자 관리 테스트

### 2.1 사용자 생성 테스트
- **목적**: 관리자가 사용자 정보를 생성할 수 있는지 확인
- **테스트 케이스**:
  - 단일 사용자 생성이 정상적으로 되는지 확인
  - 다수 사용자 동시 생성이 정상적으로 되는지 확인
  - 필수 필드(ID, 키)가 누락된 경우 에러가 반환되는지 확인
  - 중복된 사용자 ID로 생성 시도 시 에러가 반환되는지 확인
  - 허용 모델과 서비스 정보가 정상적으로 저장되는지 확인
  - 사용자 생성 이벤트가 로그에 기록되는지 확인

### 2.2 사용자 조회 테스트
- **목적**: 사용자 정보 조회 기능이 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 전체 사용자 목록 조회가 정상적으로 되는지 확인
  - 조직별 필터링이 정상적으로 작동하는지 확인
  - 사용자 정보에 허용 모델과 서비스 정보가 포함되어 반환되는지 확인
  - 조회 결과가 최신 순으로 정렬되는지 확인

### 2.3 사용자 수정 테스트
- **목적**: 사용자 정보 수정 기능이 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 단일 사용자 정보 수정이 정상적으로 되는지 확인
  - 다수 사용자 동시 수정이 정상적으로 되는지 확인
  - 허용 모델 추가/삭제/교체가 정상적으로 되는지 확인
  - 허용 서비스 추가/삭제/교체가 정상적으로 되는지 확인
  - 존재하지 않는 사용자 수정 시도 시 에러가 반환되는지 확인
  - 사용자 수정 이벤트가 로그에 기록되는지 확인

### 2.4 사용자 삭제 테스트
- **목적**: 사용자 삭제 기능이 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 단일 사용자 삭제가 정상적으로 되는지 확인
  - 다수 사용자 동시 삭제가 정상적으로 되는지 확인
  - 삭제된 사용자의 관련 데이터(허용 모델, 서비스, 이벤트 로그)가 함께 삭제되는지 확인
  - 존재하지 않는 사용자 삭제 시도 시 에러가 반환되는지 확인
  - 사용자 삭제 이벤트가 로그에 기록되는지 확인

## 3. REST API 테스트

### 3.1 키 조회 API 테스트
- **목적**: 외부 시스템에서 사용자 키 정보를 조회할 수 있는지 확인
- **테스트 케이스**:
  - 단일 사용자 키 조회가 정상적으로 되는지 확인
  - 다수 사용자 키 동시 조회가 정상적으로 되는지 확인
  - 올바른 API 키로 요청 시 정상 응답이 반환되는지 확인
  - 잘못된 API 키로 요청 시 401 에러가 반환되는지 확인
  - 존재하지 않는 사용자 ID로 요청 시 적절한 에러가 반환되는지 확인
  - API 요청 이벤트가 로그에 기록되는지 확인

### 3.2 LiteLLM 모델 조회 API 테스트
- **목적**: LiteLLM에서 사용 가능한 모델 정보를 조회할 수 있는지 확인
- **테스트 케이스**:
  - 관리자 권한으로 모델 목록 조회가 정상적으로 되는지 확인
  - 비인증 사용자가 모델 목록 조회 시도 시 401 에러가 반환되는지 확인
  - 모델 정보가 올바른 형식으로 반환되는지 확인

## 4. 이벤트 로그 테스트

### 4.1 이벤트 로그 기록 테스트
- **목적**: 모든 관리 작업과 API 요청이 이벤트 로그에 기록되는지 확인
- **테스트 케이스**:
  - 사용자 생성/수정/삭제 시 이벤트 로그가 기록되는지 확인
  - 로그인/로그아웃 시 이벤트 로그가 기록되는지 확인
  - 패스워드 변경 시 이벤트 로그가 기록되는지 확인
  - API 요청 시 이벤트 로그가 기록되는지 확인
  - 이벤트 로그에 관리자 정보, 사용자 정보, 결과가 포함되는지 확인

### 4.2 이벤트 로그 조회 테스트
- **목적**: 이벤트 로그 조회 기능이 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 전체 이벤트 로그 조회가 정상적으로 되는지 확인
  - 관리자별 필터링이 정상적으로 작동하는지 확인
  - 사용자별 필터링이 정상적으로 작동하는지 확인
  - 이벤트 타입별 필터링이 정상적으로 작동하는지 확인
  - 날짜 범위 필터링이 정상적으로 작동하는지 확인
  - 결과별 필터링(성공/실패)이 정상적으로 작동하는지 확인
  - 페이지네이션이 정상적으로 작동하는지 확인

## 5. 프론트엔드 UI 테스트

### 5.1 로그인 페이지 테스트
- **목적**: 로그인 페이지가 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 로그인 폼이 올바르게 렌더링되는지 확인
  - 입력 유효성 검사가 정상적으로 작동하는지 확인
  - 로그인 성공 시 메인 페이지로 이동하는지 확인
  - 로그인 실패 시 적절한 에러 메시지가 표시되는지 확인
  - JWT 토큰 만료 시 자동 로그아웃 및 로그인 페이지로 이동하는지 확인

### 5.2 메인 페이지 테스트
- **목적**: 사용자 관리 메인 페이지가 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 사용자 목록이 정상적으로 표시되는지 확인
  - 사용자 검색 기능이 정상적으로 작동하는지 확인
  - 사용자 정렬 기능이 정상적으로 작동하는지 확인
  - 사용자 선택 기능이 정상적으로 작동하는지 확인
  - 다수 사용자 동시 선택이 정상적으로 작동하는지 확인
  - 사용자 정보 수정 다이얼로그가 정상적으로 작동하는지 확인
  - 사용자 삭제 확인 다이얼로그가 정상적으로 작동하는지 확인

### 5.3 계정 설정 페이지 테스트
- **목적**: 계정 설정 페이지가 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 현재 관리자 정보가 정상적으로 표시되는지 확인
  - 패스워드 변경 기능이 정상적으로 작동하는지 확인
  - 로그아웃 기능이 정상적으로 작동하는지 확인

### 5.4 관리자 생성 페이지 테스트 (슈퍼 관리자 전용)
- **목적**: 슈퍼 관리자가 새로운 관리자를 생성할 수 있는지 확인
- **테스트 케이스**:
  - 관리자 생성 폼이 정상적으로 렌더링되는지 확인
  - 입력 유효성 검사가 정상적으로 작동하는지 확인
  - 관리자 생성 성공 시 적절한 메시지가 표시되는지 확인
  - 일반 관리자가 접근 시 권한 에러가 표시되는지 확인

### 5.5 이벤트 로그 페이지 테스트
- **목적**: 이벤트 로그 페이지가 정상적으로 작동하는지 확인
- **테스트 케이스**:
  - 이벤트 로그 목록이 정상적으로 표시되는지 확인
  - 필터링 기능이 정상적으로 작동하는지 확인
  - 페이지네이션이 정상적으로 작동하는지 확인
  - 이벤트 상세 정보가 정상적으로 표시되는지 확인

## 6. 통합 테스트

### 6.1 전체 워크플로우 테스트
- **목적**: 전체 시스템이 통합적으로 정상 작동하는지 확인
- **테스트 케이스**:
  - 관리자 로그인 → 사용자 생성 → 사용자 수정 → 사용자 삭제 → 로그아웃 전체 플로우가 정상적으로 작동하는지 확인
  - 다수 사용자 동시 처리 시 데이터 일관성이 유지되는지 확인
  - API 요청과 웹 UI 작업이 모두 이벤트 로그에 기록되는지 확인
  - 시스템 재시작 후 데이터가 정상적으로 복구되는지 확인

### 6.2 성능 테스트
- **목적**: 시스템이 적절한 성능을 보이는지 확인
- **테스트 케이스**:
  - 대량의 사용자 데이터 조회 시 응답 시간이 적절한지 확인
  - 다수 사용자 동시 수정 시 성능이 저하되지 않는지 확인
  - 이벤트 로그 대량 조회 시 성능이 적절한지 확인

### 6.3 보안 테스트
- **목적**: 시스템 보안이 적절히 구현되어 있는지 확인
- **테스트 케이스**:
  - 인증되지 않은 사용자의 API 접근이 차단되는지 확인
  - 권한이 없는 관리자의 기능 접근이 차단되는지 확인
  - JWT 토큰이 적절히 검증되는지 확인
  - 패스워드가 안전하게 해시되어 저장되는지 확인

## 7. 테스트 실행 방법

### 7.1 자동화된 테스트 실행
```bash
# 백엔드 테스트 실행
cd tests
python -m pytest unit/ -v
python -m pytest integration/ -v

# 프론트엔드 테스트 실행
cd frontend
npm test
```

### 7.2 수동 테스트 체크리스트
- [ ] 슈퍼 관리자 계정으로 로그인
- [ ] 일반 관리자 계정 생성
- [ ] 사용자 정보 생성 (단일/다수)
- [ ] 사용자 정보 조회 및 필터링
- [ ] 사용자 정보 수정 (단일/다수)
- [ ] 사용자 정보 삭제 (단일/다수)
- [ ] REST API 키 조회 테스트
- [ ] 이벤트 로그 조회 및 필터링
- [ ] 프론트엔드 UI 기능 테스트
- [ ] 권한별 접근 제어 테스트

### 7.3 테스트 환경 설정
```bash
# 테스트용 Docker 환경 실행
docker compose -f docker-compose.test.yml up -d

# 테스트 데이터베이스 마이그레이션
docker compose -f docker-compose.test.yml run --rm migrate

# 테스트 실행
docker compose -f docker-compose.test.yml run --rm test
```
