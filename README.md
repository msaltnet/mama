# mama

mama는 사용자 정보에 맞게 LiteLLM Virtual Key를 손쉽게 관리할 수 있는 Key Management 시스템입니다. 관리자는 Web UI를 통해 사용자 정보를 관리할 수 있으며, 관련 시스템은 REST API를 통해 Key와 사용자 정보를 얻을 수 있습니다.

## 요구사항
- 관리자가 권한 업데이트 할 수 있는 Web UI를 제공한다
  - 슈퍼 관리자는 정보는 admin/admin으로 최초 생성된다
  - 슈퍼 관리자는 관리자 계정을 생성/삭제 할 수 있어야 한다
  - 관리자는 자신의 패스워드를 변경할 수 있다
  - 사용자 정보는 ID, 조직, 키, 허용 모델, 허용 서비스, 기타 정보를 포함
  - 다수 사용자의 정보를 조회 할 수 있다
  - 다수 사용자의 정보를 동시에 변경 할 수 있다
  - 허용 모델과 서비스 정보를 업데이트 할 때 교체, 추가, 삭제 할 수 있다
- 사용자 정보를 통해 Key를 조회할 수 있는 REST API를 제공한다
  - 다수의 사용자 ID를 입력 받고, 그에 해당하는 정보를 반환한다
- 발급된 Key를 포함한 사용자 정보는 DB에 저장된다
- 모든 사용자 정보 조회/수정 이벤트와 API 요청은 결과와 함께 저장된다

## 작업 순서
1. 데이터베이스 및 데이터 모델 설계
   - 사용자, 키, 허용 모델/서비스, 이벤트 로그 등 테이블 구조 설계 및 DB 반영
2. 슈퍼 관리자(admin/admin) 계정 자동 생성 로직 구현
3. 인증 및 권한 관리 기능 구현
   - 로그인, 패스워드 변경, 관리자/슈퍼관리자 권한 구분 등
4. Web UI 관리자 기능 구현
   - 관리자 계정 생성/삭제, 패스워드 변경, 사용자 정보 조회/수정, 다수 사용자 동시 처리, 허용 모델/서비스 관리 등
5. REST API 구현
   - 사용자 ID 리스트로 정보 및 키 반환 API
6. 이벤트 및 API 요청 로그 저장 기능 구현
   - 모든 정보 조회/수정, API 요청 결과를 이벤트 로그로 저장
7. 테스트 및 문서화
   - 각 기능별 테스트 코드 작성 및 문서 보완

## Alembic 마이그레이션 사용법

### 1. Alembic 환경 초기화(최초 1회)
```
pip install alembic
alembic init alembic
```

### 2. 마이그레이션 파일 생성
```
alembic revision --autogenerate -m "메시지"
```

### 3. 마이그레이션 적용(업그레이드)
```
alembic upgrade head
```

### 4. 마이그레이션 롤백(다운그레이드)
```
alembic downgrade -1
```

### 5. 환경설정
- DB 연결 정보는 `.env` 파일에서 관리하며, `alembic/env.py`에서 자동으로 불러옵니다.
- 모델 변경 시 `alembic revision --autogenerate`로 변경사항을 감지할 수 있습니다.
- 마이그레이션 파일은 `alembic/versions/` 폴더에 생성됩니다.

### 6. 마이그레이션 버전 및 히스토리 확인
- 현재 DB에 적용된 마이그레이션 버전 확인
```
alembic current
```
- 전체 마이그레이션 히스토리 확인
```
alembic history
```

